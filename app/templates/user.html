{% extends "base.html" %}

{% block content %}
<div class="container py-4">
    <div class="row align-items-center mb-4">
        <div class="col-md-3 text-center">
            <img src="{{ user.avatar(256) }}" class="rounded-circle img-fluid shadow-sm" alt="User avatar">
        </div>
        <div class="col-md-9">
            <h1 class="fw-bold">{{ user.username }}</h1>
            {% if user.about_me %}
            <p class="text-muted">{{ user.about_me }}</p>
            {% endif %}
            {% if user.last_seen %}
            <p class="small text-secondary mb-1">
                Last seen: {{ moment(user.last_seen).format('LLL') }}
            </p>
            {% endif %}
            <p>
                <span class="badge bg-primary">{{ user.followers_count() }} Followers</span>
                <span class="badge bg-secondary">{{ user.following_count() }} Following</span>
            </p>

            {% if user == current_user %}
            <a href="{{ url_for('main.edit_profile') }}" class="btn btn-outline-primary btn-sm">Edit Profile</a>
            {% elif not current_user.is_following(user) %}
            <form action="{{ url_for('main.follow', username=user.username) }}" method="post" class="d-inline">
                {{ form.hidden_tag() }}
                <button type="submit" class="btn btn-primary btn-sm">Follow</button>
            </form>
            {% else %}
            <form action="{{ url_for('main.unfollow', username=user.username) }}" method="post" class="d-inline">
                {{ form.hidden_tag() }}
                <button type="submit" class="btn btn-outline-danger btn-sm">Unfollow</button>
            </form>
            {% endif %}
        </div>
    </div>

    <hr>

    <h3 class="mb-3">Posts</h3>
    <div class="row g-3">
        {% for post in posts %}
        <div class="col-12">
            {% include '_post.html' %}
        </div>
        {% else %}
        <p class="text-muted">No posts yet...</p>
        {% endfor %}
    </div>

    <nav aria-label="Post navigation" class="mt-3">
        <ul class="pagination justify-content-center">
            <li class="page-item{% if not prev_url %} disabled{% endif %}">
                <a class="page-link" href="{{ prev_url }}">
                    &larr; Newer posts
                </a>
            </li>
            <li class="page-item{% if not next_url %} disabled{% endif %}">
                <a class="page-link" href="{{ next_url }}">
                    Older posts &rarr;
                </a>
            </li>
        </ul>
    </nav>

    {% if user == current_user and pending_posts %}
    <hr>
    <h3 class="mb-3">Pending Posts</h3>
    <div class="row g-3">
        {% for post in pending_posts %}
        <div class="col-12">
            {% include '_post.html' %}
        </div>
        {% endfor %}
    </div>

    <nav aria-label="Pending post navigation" class="mt-3">
        <ul class="pagination justify-content-center">
            <li class="page-item{% if not p_prev_url %} disabled{% endif %}">
                <a class="page-link" href="{{ p_prev_url }}">
                    &larr; Newer posts
                </a>
            </li>
            <li class="page-item{% if not p_next_url %} disabled{% endif %}">
                <a class="page-link" href="{{ p_next_url }}">
                    Older posts &rarr;
                </a>
            </li>
        </ul>
    </nav>
    {% endif %}
</div>
{% endblock %}